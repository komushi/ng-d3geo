<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>日本地図を描画する</title>
  <style type="text/css">
    svg {
      fill: #7986cb;
      stroke-width: 0.5;
    }
  </style>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v0.min.js"></script>
</head>
<body>

<script>


    function redraw() {
      // d3.event.translate (an array) stores the current translation from the parent SVG element
      // t (an array) stores the projection's default translation
      // we add the x and y vales in each array to determine the projection's new translation
      var tx = t[0] * d3.event.scale + d3.event.translate[0];
      var ty = t[1] * d3.event.scale + d3.event.translate[1];
      projection.translate([tx, ty]);

      // now we determine the projection's new scale, but there's a problem:
      // the map doesn't 'zoom onto the mouse point'
      projection.scale(s * d3.event.scale);

      // redraw the map
      svg.selectAll("path").attr("d", path);

    }


var width = 1500;
var height = 700;

// var color = d3.scale.linear().domain([1,10])
//               .interpolate(d3.interpolateHcl)
//               .range([d3.rgb("#0d47a1"), d3.rgb('#e3f2fd')]);

var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height)
  .attr("style", "outline: thin solid gray;")
  .call(d3.behavior.zoom().on("zoom", redraw));

var projection = d3.geo.mercator()
  // [139.426846, 35.699450] for tokyo
  // [139.726846, 35.679450] for tokyo23
  .center([139.726846, 35.679450])
  // scale(80000)] for tokyo
  // scale(11000)] for tokyo23
  .scale(110000)
  .translate([width / 2, height / 2]);

var path = d3.geo.path()
  .projection(projection);

var t = projection.translate(); // the projection's default translation
var s = projection.scale() // the projection's default scale

d3.json("data/tokyo_23_simple.json", function (error, json) {



console.log(json);

var features = topojson.object(json, json.objects['tokyo_23_simple']);


  svg.selectAll("path")
  // .data(features)
  .data(features.geometries)
  .enter()
  .append("path")
  .attr("stroke", "white")
  .attr("stroke-width", "0.5")
  .attr("d", path);
  // .attr("fill", function(d,i) { 
  //   return color(Math.floor((i)/features.geometries.length*10));
  // });

  
});
</script>
</body>
</html>