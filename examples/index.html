<!DOCTYPE html>
<html>

<head>
  <title>ngd3geo app</title>

    <script type="text/javascript" src="lib/angular/angular.min.js"></script>
    <script type="text/javascript" src="lib/d3/d3.min.js"></script>
    <script type="text/javascript" src="lib/topojson/topojson.min.js"></script>
    <script type="text/javascript" src="lib/rxjs/rx.all.min.js"></script>
    <script type="text/javascript" src="lib/rx-angular/rx.angular.min.js"></script>
    <script type="text/javascript" src="lib/ng-d3geo/ng-d3geo.js"></script>
    <link rel="stylesheet" href="lib/ng-d3geo/css/ng-d3geo.css" /> 

</head>


<body ng-app="d3geoApp">

<script>
var app = angular.module("d3geoApp", ['ngD3geo']); 
app.controller("2layerMapCtrl", ['$scope', '$http', '$interval', function($scope, $http, $interval) {
  

/*
  var coordinates =
  [[139.734291,35.688634],
  [139.760496,35.690335],
  [139.770401,35.694069],
  [139.765043,35.68835],
  [139.7661246316267,35.68825974504272],
  [139.7657681127479,35.687651654673644],
  [139.745212,35.691125],
  [139.759712,35.700672],
  [139.755267,35.693319],
  [139.761334,35.674706],
  [139.750424,35.670865],
  [139.7414532200372,35.679581104938],
  [139.749899,35.701827],
  [139.74692,35.696674],
  [139.740164,35.692643],
  [139.768072,35.687348],
  [139.75074,35.671377],
  [139.743383,35.697602],
  [139.764721,35.679816],
  [139.7507934778318,35.671386654224115],
  [139.7507934778318,35.671386654224115],
  [139.7507934778318,35.671386654224115],
  [139.743383,35.697602],
  [139.7507934778318,35.671386654224115],
  [139.76294,35.677412],
  [139.76585163985027,35.68940619519768],
  [139.761877,35.675639],
  [139.7507934778318,35.671386654224115],
  [139.746458,35.671899],
  [139.74692,35.696674],
  [139.746458,35.671899],
  [139.766939,35.683965],
  [139.737945,35.688772],
  [139.754544,35.669638],
  [139.757993,35.692478],
  [139.750962,35.672238],
  [139.765683,35.676349],
  [139.73610888396263,35.68553725865768],
  [139.73610888396263,35.685537258666734],
  [139.753961,35.690292],
  [139.757993,35.692478],
  [139.752018,35.671321],
  [139.757993,35.692478],
  [139.734048,35.684031],
  [139.742659,35.680767],
  [139.754544,35.669638],
  [139.753683,35.698596],
  [139.750424,35.670865],
  [139.765854,35.689364],
  [139.745793,35.692572],
  [139.745796,35.67096],
  [139.75463308702805,35.690506392289514],
  [139.757993,35.692478],
  [139.76441428407463,35.687749511028905],
  [139.742659,35.680767],
  [139.742659,35.680767],
  [139.754544,35.669638],
  [139.742824,35.675821],
  [139.742463,35.678098],
  [139.744685,35.676487],
  [139.742463,35.678098],
  [139.745074,35.675182],
  [139.7470116382056,35.678418885519754],
  [139.742463,35.678098],
  [139.74505617405612,35.67525922701384],
  [139.74465211932687,35.6765672952068],
  [139.74505617405615,35.675254401080785],
  [139.7484141620185,35.67166693581735],
  [139.752737,35.672691],
  [139.748046,35.673099],
  [139.742657,35.67882],
  [139.748046,35.673099],
  [139.748046,35.673099],
  [139.748046,35.673099],
  [139.748046,35.673099],
  [139.750157,35.676043],
  [139.748046,35.673099],
  [139.742657,35.67882],
  [139.748046,35.673099],
  [139.753073,35.673377],
  [139.745518,35.673015],
  [139.748046,35.673099],
  [139.7452951757008,35.67302465399794],
  [139.762711,35.689542],
  [139.7406821860937,35.67312691603093],
  [139.742657,35.67882],
  [139.742657,35.67882],
  [139.7453011176821,35.67295707637637],
  [139.762711,35.689542],
  [139.748046,35.673099],
  [139.742657,35.67882],
  [139.7453011176821,35.67295707637637],
  [139.743713,35.672988],
  [139.7541,35.683792],
  [139.74798931035463,35.67179002702629],
  [139.75461119813127,35.67567441585073],
  [139.74071189600025,35.67305209778313],
  [139.75124,35.675626],
  [139.75124,35.675626],
  [139.758656,35.685403]];

  var timer;

  $scope.subEventsFrom = function (feature) {
    console.log("subEventsFrom" + feature);

    if (feature == '101') {
      timer = 
        $interval(function(){
          var min = 0;
          var max = coordinates.length - 1;
          var from = Math.floor(Math.random() * (max - min + 1)) + min;
          var to = Math.floor(Math.random() * (max - min + 1)) + min;
          var dot;
          if (from <= to) {
            dot = coordinates.slice(from, to);
          }
          else {
            dot = coordinates.slice(to, from);
          }
          $scope.circleData = dot;
        }, 5000);  
    }
  };

  $scope.unsubEvents = function () {
    console.log("unsubEvents called");
    $interval.cancel(timer);
    timer = null;
  };
*/


  var featureCodes =
  ['1010360', '1010110', '1020070', '1020190', '1190350', '1150210', '1190100', '1190130', '1190050', '1170160', '1030120', '1110250', '1110210', '1130180', '1130150', '1040850', '1040640', '1040630', '1040540', '1040380', '1040430', '1040290', '1040040', '1120050', '1010080', '1010180', '1010410', '1060030', '1060090', '1060320', '1090010', '1090090', '1090130', '1090210', '1070020', '1070080', '1070190', '1110010', '1110150', '1050180'];


  var i = 0;
  $interval(function(){
    var min = 0;
    var max = featureCodes.length - 1;

    var routes = [];

    for (i = 0; i < 10; i++) {
      var from = Math.floor(Math.random() * (max - min + 1)) + min;
      var to = Math.floor(Math.random() * (max - min + 1)) + min;
      routes.push({from: featureCodes.slice(from, from + 1)[0], to: featureCodes.slice(to, to + 1)[0]});
    }





    // i++;
    
    // if (i % 2 == 0) {
    //   routes.push({from: 1010360, to: 1190130});
    //   routes.push({from: 1010360, to: 1110150});
    //   routes.push({from: 1130180, to: 1170160});
    //   routes.push({from: 1090010, to: 1170160});
    // } else {
    //   routes.push({from: 1040850, to: 1060320});
    //   routes.push({from: 1040850, to: 1150210});
    //   routes.push({from: 1030120, to: 1110010});
    //   routes.push({from: 1040040, to: 1110010});
    // }

    $scope.routes = routes;

  }, 3000);
  


  // $interval(function(){
  //   var min = 0;
  //   var max = featureCodes.length - 1;

  //   var codes = [];

  //   while(codes.length < 10) {
  //     var from = Math.floor(Math.random() * (max - min + 1)) + min;
  //     var code = featureCodes.slice(from, from + 1)[0];
  //     if (codes.indexOf(code) == -1) {
  //       codes.push(code);        
  //     }
  //   }

  //   $scope.featureCodes = codes;

  // }, 1500);


}]);
</script>

<div ng-controller="2layerMapCtrl">

<!--   <div>
    <h2>2-Layer Map Tokyo</h2>
    <div 2layer-map
      id="01"
      data="circleData"
      topojson-path="data/tokyo_23_blocks_districts_final.json"
      width="800"
      height="800"
      layer1-color-range="#0d47a1,#e3f2fd"
      center="139.752268, 35.677043"
      scale="110000"
      layer1-objects="districts"
      layer2-objects="blocks"
      layer1-feature-name="properties.district"
      layer1-feature-code="properties.district_code"
      layer2-feature-name="properties.block"
      layer2-feature-code="properties.block_code"
      on-receive-events="subEventsFrom(feature)"
      on-stop-events="unsubEvents()"
      >
    </div>
  </div> -->

  <br/>
  <br/>
  <div>
    <h2>Route Events Tokyo</h2>
    <div route-events-map
      id="02"
      data="routes"
      topojson-path="data/tokyo_23_blocks_districts_final.json"
      width="1000"
      height="1000"
      bg-color="#bbdefb"
      color-range="#227AFF,#FFF500"
      center="139.752268, 35.677043"
      scale="150000"
      layer-objects="blocks"
      layer-feature-name="properties.block"
      layer-feature-code="properties.block_code"
      >
    </div>
  </div>

<!--   <br/>
  <br/>
  <div>
    <h2>Receiving Events Tokyo</h2>
    <div events-map
      id="02"
      data="featureCodes"
      topojson-path="data/tokyo_23_blocks_districts_final.json"
      width="1000"
      height="1000"
      bg-color="#bbdefb"
      color-range="#227AFF,#FFF500"
      center="139.752268, 35.677043"
      scale="150000"
      layer-objects="blocks"
      layer-feature-name="properties.block"
      layer-feature-code="properties.block_code"
      >
    </div>
  </div> -->

<!--   <br/>
  <br/>
  <div style="width:1500px; height:800px;">
    <h2>Static Map Tokyo</h2>
    <div static-map
      id="03"
      topojson-path="data/tokyo_23_blocks_districts_final.json"
      width="1000"
      height="1000"
      color-range="#0d47a1,#e3f2fd"
      center="139.752268, 35.677043"
      scale="110000"
      layer-objects="blocks"
      layer-feature-name="properties.block"
      layer-feature-code="properties.block_code"
      feature-name-style="hover"
      >
    </div>
  </div> -->

<!--   <br/>
  <br/>
  <div style="width:1500px; height:800px;">
    <h2>Zoom & Map Tokyo</h2>
    <div zoom-pan-map
      id="04"
      topojson-path="data/tokyo_23_blocks_districts_final.json"
      width="1000"
      height="1000"
      color-range="#0d47a1,#e3f2fd"
      center="139.752268, 35.677043"
      scale="110000"
      layer-objects="blocks"
      layer-feature-name="properties.block"
      layer-feature-code="properties.block_code"
      feature-name-style="hover"
      >
    </div>
  </div> -->


<!--   <br/>
  <br/>
  <div style="width:1500px; height:800px;">
    <h2>2-Layer Map US</h2>
    <div 2layer-map
      id="04"
      topojson-path="data/us_counties_states_final.json"
      width="1200"
      height="600"
      layer1-color-range="#0d47a1,#e3f2fd"
      center="-99.736816, 38.818207"
      scale="1000"
      layer1-objects="us_states"
      layer2-objects="us_counties"
      layer1-feature-name="properties.state_code"
      layer1-feature-code="properties.state_code"
      layer2-feature-name="properties.county"
      layer2-feature-code="properties.county_code"
      >
    </div>
  </div> -->

</div>


</body>
</html>
